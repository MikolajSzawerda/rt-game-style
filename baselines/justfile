# baselines/justfile - Shared recipes for baseline models

set dotenv-load

eval_dir := "../evaluation"
github_gbgst := "https://raw.githubusercontent.com/ioannouE/GBGST/main"

# =============================================================================
# EVALUATION DATA
# =============================================================================

# Download style images from GBGST repo (matches pretrained model names)
[group('data')]
download-styles:
    #!/usr/bin/env bash
    set -euo pipefail
    mkdir -p {{eval_dir}}/style
    
    styles="starry_night mosaic feathers wave composition_vii"
    for style in $styles; do
        if [ ! -f "{{eval_dir}}/style/${style}.jpg" ]; then
            echo "Downloading ${style}.jpg..."
            curl -fSL -o "{{eval_dir}}/style/${style}.jpg" \
                "{{github_gbgst}}/images/styles/${style}.jpg"
        else
            echo "✓ ${style}.jpg exists"
        fi
    done
    echo "Done! Styles in {{eval_dir}}/style/"

# Download content images from GBGST repo
[group('data')]
download-content:
    #!/usr/bin/env bash
    set -euo pipefail
    mkdir -p {{eval_dir}}/content
    
    images="church dandelion lighthouse ship tuebingen_neckarfront"
    for img in $images; do
        if [ ! -f "{{eval_dir}}/content/${img}.jpg" ]; then
            echo "Downloading ${img}.jpg..."
            curl -fSL -o "{{eval_dir}}/content/${img}.jpg" \
                "{{github_gbgst}}/images/content/${img}.jpg"
        else
            echo "✓ ${img}.jpg exists"
        fi
    done
    echo "Done! Content in {{eval_dir}}/content/"

# Download all evaluation data
[group('data')]
download-all: download-styles download-content
    @echo "All evaluation data ready!"

# =============================================================================
# UTILITIES
# =============================================================================

# List available baselines
list:
    @echo "Baselines:" && ls -d */ 2>/dev/null | grep -v shared | sed 's/\///'

# Check status of all baselines  
status:
    #!/usr/bin/env bash
    echo "Baseline Status:"
    for dir in */; do
        [ "$dir" = "shared/" ] && continue
        [ -f "${dir}justfile" ] || continue
        name="${dir%/}"
        if [ -d "${dir}.venv" ]; then
            echo "  ✓ $name"
        else
            echo "  ○ $name (run: cd $name && just setup)"
        fi
    done

# Clean all generated outputs
clean-all:
    #!/usr/bin/env bash
    for dir in */; do
        [ "$dir" = "shared/" ] && continue
        [ -f "${dir}justfile" ] && (cd "$dir" && just clean 2>/dev/null || true)
    done
